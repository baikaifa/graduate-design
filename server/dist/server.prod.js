"use strict";var express=require("express"),mongoose=require("mongoose"),bodyParser=require("body-parser"),passport=require("passport"),cookieParser=require("cookie-parser"),app=express(),server=require("http").Server(app),io=require("socket.io")(server),pathLib=require("path");app.get("/",function(e,r){r.json("ok")}),app.post("/api/upload_file",function(e,r){var i=e.files[0].path+pathLib.parse(e.files[0].originalname).ext;fs.rename(e.files[0].path,i,function(e){e?r.send("上传失败"):r.send("成功")})}),io.on("connection",function(e){e.on("sendmsg",function(e){console.log("我发送了数据",e),io.emit("recvmsg",e)})});var users=require("./routers/api/users"),profiles=require("./routers/api/profiles"),headerList=require("./routers/api/headerList"),detail=require("./routers/api/detail"),home=require("./routers/api/home"),homeList=require("./routers/api/homeList"),topicList=require("./routers/api/topicList"),articleList=require("./routers/api/articleList"),recommendList=require("./routers/api/recommendList"),fourList=require("./routers/api/fourList"),loadMore=require("./routers/api/loadMore"),fileRouter=require("./routers/api/fileRouter"),commentList=require("./routers/api/commentList");app.use(cookieParser()),app.use(bodyParser.urlencoded({extended:!1,useUnifiedTopology:!0})),app.use(bodyParser.json()),app.use(passport.initialize()),require("./config/passport")(passport),app.use("/api/commentList",commentList),app.use("/api/users",users),app.use("/api/profiles",profiles),app.use("/api/headerList",headerList),app.use("/api/detail",detail),app.use("/api/home",home),app.use("/api/homeList",homeList),app.use("/api/topicList",topicList),app.use("/api/articleList",articleList),app.use("/api/fourList",fourList),app.use("/api/recommendList",recommendList),app.use("/api/loadMore",loadMore),app.use("/api/fileRouter",fileRouter);var port=process.env.PORT||5e3,url="mongodb://localhost:27017/houtai";mongoose.connect(url,{useNewUrlParser:!0}).then(function(){console.log("连接成功")}).catch(function(e){return console.log(e)}),server.listen(port,function(){console.log("Server running on port ".concat(port))});